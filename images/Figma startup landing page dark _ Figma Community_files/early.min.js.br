self.global=self;var p=(t,s,e,i)=>{var w;if(t)window.userStateXHR={readyState:4,status:200,responseText:t};else if(window.Fig){if(i||!window.INITIAL_OPTIONS.user_data){window.startUserStateXHR=()=>{};return}window.startUserStateXHR=function(n){var c;var o="/api/user/state",a=[];window.INITIAL_OPTIONS.org_id&&a.push("org_id="+window.INITIAL_OPTIONS.org_id),e&&a.push("omit_core_data=1"),n&&a.push("file_key="+n),a.length!==0&&(o+="?"+a.join("&")),window.userStateXHR=new XMLHttpRequest,window.userStateXHR.open("GET",o);let d=(c=window.INITIAL_OPTIONS.user_data)==null?void 0:c.id;d&&window.userStateXHR.setRequestHeader("X-Figma-User-ID",d),window.userStateXHR.send();var I=window.performance?window.performance.now():-1;window.userStateXHR.addEventListener("load",function(){window.userStateXHRDuration=window.performance?window.performance.now()-I:-1},!1),window.sessionStateXHR=new XMLHttpRequest,window.sessionStateXHR.open("GET","/api/session/state"),d&&window.sessionStateXHR.setRequestHeader("X-Figma-User-ID",d),window.sessionStateXHR.send()};let r=location.pathname==="/preload-editor"||location.pathname==="/file/new",l=window.INITIAL_OPTIONS.editing_file&&window.INITIAL_OPTIONS.editing_file.key;s?window.startUserStateXHR(l):r||window.startUserStateXHR()}else if(location.pathname.startsWith("/community")){window.sessionStateXHR=new XMLHttpRequest,window.sessionStateXHR.open("GET","/api/session/state");let r=(w=window.INITIAL_OPTIONS.user_data)==null?void 0:w.id;r&&window.sessionStateXHR.setRequestHeader("X-Figma-User-ID",r),window.sessionStateXHR.send()}};function P(t){return t==="dark"?"1E1E1E":"F5F5F5"}function D(){var i;if(!((i=window.INITIAL_OPTIONS.feature_flags)!=null&&i.send_initial_bg_color))return"";let t=null;try{t=window.localStorage}catch(w){}let s=H(t),e=M(s);return P(e)}var k="global-debug-theme-preference";function H(t){var s;if(t){let e=t==null?void 0:t.getItem(k);return(s=window.INITIAL_OPTIONS.feature_flags)!=null&&s.ee_system_theme_default&&!e?"system":e}return null}var F=window.matchMedia("(prefers-color-scheme: dark)");function M(t){return t==="system"?F.matches?"dark":"light":t==="dark"?"dark":"light"}var A="chunked-file-load",$="file-load-streaming-compression",v=5e3,C=(t,s)=>{var r;let e=(r=window.INITIAL_OPTIONS.user_data)==null?void 0:r.id,i=window.INITIAL_OPTIONS.tracking_session_id,w=window.INITIAL_OPTIONS.release_manifest_git_commit;window.mpGlobal={version:71,sock:null,msgs:[],perfMetrics:[],shouldConnectToMultiplayer:t,url({fileKey:l,role:n,oauthToken:o,nodeIds:a,initialBgColor:d,suppressDecodeErrors:I,connectionType:c}){var T,h,E,m,O,N,R,L;if(!t)return"";let f=null;s&&l===s.fileKey&&s.targetFileVersion&&(f=s.targetFileVersion);let u="";(n==="editor"||n==="viewerWithCpp")&&a&&(u=`&scenegraph-queries-initial-nodes=${a}`),n==="editor"&&((T=window.INITIAL_OPTIONS.feature_flags)!=null&&T.ep_editor_incremental_loading||(s==null?void 0:s.forceIncrementalForEditors)===1)&&(s==null?void 0:s.forceIncrementalForEditors)!==0&&(u="&use-incremental-for-editors=1");let _=1;try{let g=JSON.parse(sessionStorage.getItem("reload_times")||"[0]"),b=g[g.length-1];_=Date.now()-b<5e3?1:0}catch(g){}(n!=="editor"||!((h=window.INITIAL_OPTIONS.feature_flags)!=null&&h.send_initial_bg_color))&&(d="");let S=((E=window.INITIAL_OPTIONS.feature_flags)==null?void 0:E.chunked_file_load)&&c==="initial-load",U=(m=window.INITIAL_OPTIONS.feature_flags)!=null&&m.chunked_size_1000?1e3:(O=window.INITIAL_OPTIONS.feature_flags)!=null&&O.chunked_size_5000?5e3:(N=window.INITIAL_OPTIONS.feature_flags)!=null&&N.chunked_size_10000?1e4:(R=window.INITIAL_OPTIONS.feature_flags)!=null&&R.chunked_size_20000?2e4:v,X=(L=window.INITIAL_OPTIONS.feature_flags)==null?void 0:L.file_load_streaming_compression;return`${location.protocol.replace("http","ws")}//${location.host}/api/multiplayer/${l}?role=${n}&tracking_session_id=${i}&version=${this.version}&recentReload=${_}`+(o?"&oauth_token="+o:"")+u+(e?`&user-id=${e}`:"")+(f?`&target-file-version=${f}`:"")+(w?`&client_release=${w}`:"")+(d?`&initial-bg-color=${d}`:"")+(I?"&suppress-decode-errors":"")+(S?`&${A}`:"")+(S?`&chunk-size=${U}`:"")+(X?`&${$}`:"")},DEBUG_THEME_PREFERENCE_KEY:k,DARK_THEME_MEDIA_QUERY:F,themePreferenceFromLocalStorage:H,getBackgroundColorForTheme:P,getVisibleTheme:M,REQUEST_CHUNKED_FILE_LOAD_PARAM:A,preconnect(l){if(t!==!1){if(this.sock){if(l===this.sock.url&&this.sock.readyState!==WebSocket.CLOSED)return;try{this.sock.close()}catch(n){}}this.sock=new WebSocket(l),this.sock.binaryType="arraybuffer",this.sock.onopen=n=>{this.perfMetrics.push({key:"mp-ws-onopen",ts:performance.now(),nBytes:void 0})},this.sock.onmessage=n=>{let o=new Uint8Array(n.data);this.msgs.push(o),this.perfMetrics.push({key:"mp-ws-onmessage",ts:performance.now(),nBytes:o.length*o.BYTES_PER_ELEMENT})},this.msgs=[],this.perfMetrics=[]}}},s&&mpGlobal.preconnect(mpGlobal.url(s))},G=t=>{let s=()=>{let i=document.createElement("script");return i.type="text/javascript",i.async=!0,i.setAttribute("nonce",window.INITIAL_OPTIONS.csp_nonce),i.crossOrigin="anonymous",i},e=new Promise((i,w)=>{let r=s();r.onload=i,r.src=t,document.head.appendChild(r)});return e.catch(i=>console.error(`Fetching ${t} failed: ${i}`)),e};(()=>{let{file_minimal_user_state:t,mock_user_state_for_tests_json:s,multiplayer_preconnect_options:e,omit_core_data:i,omit_user_state:w,preload_fullscreen_urls:r,should_connect_to_multiplayer:l}=window.EARLY_ARGS||{};if(window.INITIAL_OPTIONS||(window.INITIAL_OPTIONS={}),p(s,!!t,!!i,!!w),e&&(e.initialBgColor=D(),e.connectionType="initial-load"),C(l!==!1,e),!r&&!/FigmaMobile-Android/.test(navigator.userAgent)&&((e==null?void 0:e.role)==="editor"||(e==null?void 0:e.role)==="viewerWithCpp"||(e==null?void 0:e.role)==="prototype")){let n=(e==null?void 0:e.role)==="prototype"?Fig.prototypeLibURLs:Fig.fullscreenURLs,o=fetch(n["compiled_wasm.wasm"]);o.catch(d=>console.error(`Fetching compiled_wasm.wasm failed: ${d}`));let a=G(n["compiled_wasm.js"]);window.FULLSCREEN_PRELOADS={wasm:o,js:a}}})();

//# sourceMappingURL=https://admin.figma.com/admin/esbuild-artifacts/09de4c49fc62675cd22ff4279f1f3dc8631ff14c/js/early.min.js.map